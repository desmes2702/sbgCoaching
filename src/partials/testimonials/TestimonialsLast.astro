---
import { testimonials } from "@/js/data/testimonialsData";

const lastTestimonials = testimonials.filter((t) => !t.featured);
const col1 = lastTestimonials.filter((_, i) => i % 2 === 0);
const col2 = lastTestimonials.filter((_, i) => i % 2 === 1);
---

<div class="wrapper-1440">
  <section id="testimonials-last" class="testimonials-last" aria-labelledby="testimonials-heading">
    <h2 id="testimonials-heading" class="testimonials__type">Les plus anciens</h2>

    <div class="testimonials__wrapper" role="list">
      <div class="testimonials__wrapper__col1">
        {col1.map((t, i) => {
          const id = `testimonial-content-${i}`;
          return (
            <article
              class="testimonial__item"
              role="listitem"
              aria-labelledby={`testimonial-title-${i}`}
            >
              <div
                class="testimonial__item__image"
                style={`background-image: url('${t.photo}')`}
                role="img"
                aria-label={`Photo de ${t.name}`}
              ></div>

              <button
                class="testimonial__item__button"
                aria-expanded="false"
                aria-controls={id}
              >
                Voir le témoignage <span class="testimonial__item__arrow" aria-hidden="true"></span>
              </button>

              <div
                class="testimonial__item__content"
                id={id}
                hidden
                aria-live="polite"
                role="region"
              >
                <header class="testimonial__item__header">
                  <div>
                    <h3 id={`testimonial-title-${i}`} class="testimonial__item__name">{t.name}</h3>
                    {t.job && <span>{t.job}</span>}
                  </div>
                </header>
                {t.text.map((p) => <p>{p}</p>)}
              </div>
            </article>
          );
        })}
      </div>

      <div class="testimonials__wrapper__col2">
        {col2.map((t, i) => {
          const id = `testimonial-content-${i + 100}`;
          return (
            <article
              class="testimonial__item"
              role="listitem"
              aria-labelledby={`testimonial-title-${i + 100}`}
            >
              <div
                class="testimonial__item__image"
                style={`background-image: url('${t.photo}')`}
                role="img"
                aria-label={`Photo de ${t.name}`}
              ></div>

              <button
                class="testimonial__item__button"
                aria-expanded="false"
                aria-controls={id}
              >
                Voir le témoignage <span class="testimonial__item__arrow" aria-hidden="true"></span>
              </button>

              <div
                class="testimonial__item__content"
                id={id}
                hidden
                aria-live="polite"
                role="region"
              >
                <header class="testimonial__item__header">
                  <div>
                    <h3 id={`testimonial-title-${i + 100}`} class="testimonial__item__name">{t.name}</h3>
                    {t.job && <span>{t.job}</span>}
                  </div>
                </header>
                {t.text.map((p) => <p>{p}</p>)}
              </div>
            </article>
          );
        })}
      </div>
    </div>
  </section>
</div>

<script type="module">
  import { handleTestimonialClick } from "/js/testimonials/handleTestimonialClick.js";

  window.addEventListener("DOMContentLoaded", () => {
    document
      .querySelectorAll(".testimonial__item__button")
      .forEach((button) => {
        button.addEventListener("click", () => {
          handleTestimonialClick(button);
        });
      });
  });
</script>

---
import type { FaqItem } from '@/js/types/faqTypes.ts';
import { getFaqForPath } from '@/js/data/getFaqForPath.ts';

interface Props { items?: FaqItem[]; visual?: boolean }
const { items: provided, visual = true } = Astro.props;
const items = provided ?? getFaqForPath(Astro.url.pathname);
---

{items.length > 0 && (
  <script type="application/ld+json">
    {JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'FAQPage',
      mainEntity: items.map((it) => ({
        '@type': 'Question',
        name: it.question,
        acceptedAnswer: { '@type': 'Answer', text: it.answer },
      })),
    })}
  </script>
)}

{visual && items.length > 0 && (
  <div class="wrapper-982-black">
    <section class="faq section-height90 " itemscope itemtype="https://schema.org/FAQPage">
      <h2 class="faq__title subTitle">FAQ</h2>
      <h3 class="faq__subTitle title">Questions fréquentes</h3>

      <div class="faq__list">
        {items.map((item) => (
          <article class="faq__item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
            <div class="faq__question">
              <h4 itemprop="name">{item.question}</h4>
              <button
                class="faq__btn-more"
                aria-expanded="false"
                aria-label={`Afficher la réponse : ${item.question}`}
              ></button>
            </div>
            <div class="faq__answer" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
              <p itemprop="text">{item.answer}</p>
            </div>
          </article>
        ))}
      </div>
    </section>
  </div>
)}

<!-- Le script est ici car il doit être chargé après le DOM pour les interactions -->
<script>
import { initFAQ } from '../../js/global/_faq.ts';

document.addEventListener('DOMContentLoaded', initFAQ);
</script>
